Vasiliki Kostami, Amy R. Ward

# 1. Introduction

__Waiting in Service Experiences__
- Customers dislike waiting
- Service providers aim to minimize wait times
- Economically infeasible to eliminate waiting
- Important to manage customer perceptions of wait time

__Offline vs. Inline Waiting__
- Offline waiting: Customers free to engage in other activities
- Examples:
	- Restaurants with wireless devices
	- Call centers with call-back options
	- Cruises and resorts allowing wandering
	- Student health-care clinics offering return options
- Best-known example: Disneyland FASTPASS® system

__Reasons for Maintaining Both Offline and Inline Queues__
1. Some offline customers may not return at appointed time
2. Inline customers generally don't leave
3. Costs associated with customers leaving the line
4. Customer preferences may change based on wait times

__Reservation Systems__
- Not suitable for all service providers
- Disneyland's attempt: Early arrivals reserved all capacity

__Proposed Service Model__
- Customers choose between inline and offline queueing
- Homogeneous customers with linear delay costs
- Join the queue that minimizes the cost of waiting
- Service provider must:
	1. Allocate capacity between inline and offline queues
	2. Provide real-time waiting time estimates  for both the inline and offline queue

__Objective and Challenges__
- Minimize average cost associated with:
	- Customer abandonments
	- Inline queueing
- Wait time estimates that depend on that allocation decision
	- Complicated by the presence of customers in the offline queue who may abandon

# 2. Model Formulation

![[Pasted image 20241120132912.png|500]]

__Single-Server System__
- Server service rate: $\mu$
- Customers choose between:
	- Inline queue: Wait physically
	- Offline queue: Return at a specified future time
- Service discipline: Head-of-the-line generalized processor sharing
	- Inline queue processed at rate $\mu\alpha$
	- Offline queue processed at rate $\mu(1-\alpha)$

__Customer Quantities__
- $Q_I(t)$: Number of customers from the inline queue in the system
- $Q_O(t)$: Real number of customers from the offline queue in the system
	- Does not count customers that abandoned (God's perspective)
- $O(t)$: Number of customers in the offline queue recognized by the server
	- $O(t)\geq Q_O(t)$: Server's perspective, abandonment cannot be recognized as such by the server until the designated time to receive service has passed
- $\gamma[Q_O(t)-1]^+$: Poisson process rate of abandonment at time $t$
	- Can do abandonment at least there is more than one person in the queue.
	- If there is only one that person is taking service at that time
	- Customers in the offline queue who are served are all present at the service facility when the server is ready to serve them

__Waiting Time Estimations__
- **Inline Queue**: Estimated based on expected service time for all inline customers
	- Formula: $$W_I(t) = \frac{Q_I(t)}{\mu\alpha}$$
- **Offline Queue**: Estimated based on recognized offline customers
	- Formula: $$W_O(t) = \frac{O(t)}{\mu(1-\alpha)}$$
	- Overestimation expected but small when demand is high and service is fast

__Customer Decision-Making__
- Homogeneous waiting time costs
- Costs per hour: $w_I$ (inline), $w_O$ (offline)
- Customers minimize waiting cost:
	- Join inline if $$w_I I(t) \leq w_O O(t)$$
	- Otherwise, join offline queue

__Cost Minimization Objective__
- Choose $\alpha$ to minimize infinite horizon average cost
- Costs involved:
	- Abandonment cost ($c$): Refund for unrendered service
		- _But isn't this the customer's choice?_
	- Holding cost ($h$): Penalizes server for inconvenience
	- Revenue ($r$): Generated by offline customers (e.g., food, entertainment purchases)
- Assumes $r < c\gamma$ making offline queue costly

__Objective Function__
- Total cost after $t$ hours: $$C(\alpha,t)=cN\left(\int_0^t \gamma[Q_O(s)-1]^+ds\right)+\int_0^t hQ_I(s)ds -\int_0^t rQ_O(s)ds$$
- Define $$C(\alpha)=\text{lim}_{t \to \infty} \frac{C(\alpha,t)}{t}$$
- Objective: $$\min_{\alpha\in[0,1]}C(\alpha)$$


## 2.1 System Equations

__Random Variables and Processes__
- $u_i$: i.i.d. sequence for arrivals (mean 1, variance $\sigma^2_A$)
- $v^O_i$ and $v^I_i$: i.i.d. sequences for departures (mean 1, variance $\sigma^2_S$)
- $A(t)=\max\{i\geq0:\sum_{j=1}^iu_j\leq\lambda t\}$: Cumulative arrivals
- $S^I(t)=\max\{i\geq0:\sum_{j=1}^iv^I_j\leq\mu t\}$: Cumulative departures from inline queues until time $t$
- $S^O(t)=\max\{i\geq0:\sum_{j=1}^iv^O_j\leq\mu t\}$: Cumulative departures from offline queues until time $t$

__Queue Evolution Equations__
- $Q_I(t)$: Number of current inline customers in system at time $t$
	- $$Q_I(t)=\sum_{i=1}^{A(t)}\textbf{1}\{w_IW_I(t_i-)\leq w_OW_O(t_i-)\}-S_I(T_I(t))$$
	- 
- $Q_O(t)$: Number of current offline customers in system at time $t$
	- $$Q_O(t)=\sum_{i=1}^{A(t)}\textbf{1}\{w_IW_I(t_i-)> w_OW_O(t_i-)\}-N\left(\int_0^t\gamma[Q_O(s)-1]^+ds\right)-S_O(T_O(t))$$
- $T_I(t),T_O(t)$: Actual server time spent in each line until time $t$
	- $$T_I(t)=\int_0^t \frac{\alpha \textbf{1}\{Q_I(s)>0\}}{\alpha+(1-\alpha)\textbf{1}\{Q_O(s)>0\}}ds$$
	- $$T_O(t)=\int_0^t \frac{(1-\alpha) \textbf{1}\{Q_O(s)>0\}}{\alpha\textbf{1}\{Q_I(s)>0\}+(1-\alpha)}ds$$


__Total System State__
- $Q(t) = Q_I(t) + Q_O(t)$: Total customers in system
- $I(t)=\int_0^t\textbf{1}\{Q(s)=0\}ds$: Cumulative server idle time

__Server Time Balance__
- $$T_I(t) + T_O(t) + I(t) = t$$
- $$\int_0^\infty Q(t)dI(t)=0$$

__Waiting Time__
- $W_O(t)$: Actual waiting time for offline queue at time $t$
	- Customers who have arrived at the offline queue by time $t$ will have either reached the server or abandoned by time $t + W_O(t)$
	- All customers who have arrived at the offline queue by time $[t− \sup_{0≤s≤t} W_O (s)]^+$ will have either reached the server or have abandoned by time
	- Server knows at time t all the customers arriving prior to time $[t− \sup_{0≤s≤t} W_O (s)]^+$.
- $$Q_O(t) \leq O(t) \leq Q_O(t)+N\left(\int_0^t\gamma[Q_O(s)-1]^+ds\right)-N\left(\int_0^{[t− \sup_{0≤s≤t} W_O (s)]^+}\gamma[Q_O(s)-1]^+ds\right)$$
# 3. Revenue Optimization

## 3.1 Approximating Problem
- Exact analysis of capacity-allocation problem (2) is difficult
- Approximating problem becomes accurate in high-demand, fast-service regime
- $\tilde{X}$: Brownian motion with
	- drift: $\theta=(\lambda-\mu)/\lambda$
	- variance: $\sigma^2=\sigma_A^2+\sigma_S^2$
- Regulated Ornstein-Uhlenbeck process $$\tilde{Q}(t)=\tilde{X}-\gamma\frac{(1-\alpha)w_I}{\alpha w_O +(1-\alpha)w_I}\int_0^t\tilde{Q}(s)ds+\tilde{I}(t)\geq0$$
	- $\tilde{I}$: nondecreasing process

### Theorem 1
- Arrival rate: $\lambda$
- Service rate: $\mu(\lambda)=\lambda-\sqrt{\lambda}\theta$
- For $\forall T>0$ $$\sup_{0\leq t\leq T}\frac{1}{\sqrt{\lambda}}\left|\frac{w_I}{\alpha}Q_I^\lambda(t)-\frac{w_O}{1-\alpha}Q_O^\lambda(t)\right|\rightarrow0 \quad\text{as }\lambda\rightarrow\infty$$
- $$\left(\frac{Q^\lambda}{\sqrt{\lambda}},\frac{I^\lambda}{\sqrt{\lambda}}\right)\rightarrow(\tilde{Q},\tilde{I})\quad\text{as }\lambda\rightarrow\infty$$
- Queue length converges as arrival rate increases
### Corollary 1
- Arrival rate: $\lambda$
- Service rate: $\mu(\lambda)=\lambda-\sqrt{\lambda}\theta$
- $$\frac{C(\alpha,t)}{\sqrt{\lambda}}\approx \left[(c\gamma -r)\frac{(1-\alpha)w_I}{\alpha w_O +(1-\alpha)w_I}+h\frac{\alpha w_O}{\alpha w_O +(1-\alpha)w_I} \right] \int_0^t\tilde{Q}(s)ds$$
- Suggests approximation for total cost up to time t

__Approximating Optimization Problem__
- $$\frac{C(\alpha)}{\sqrt{\lambda}}\approx \left[(c\gamma -r)\frac{(1-\alpha)w_I}{\alpha w_O +(1-\alpha)w_I}+h\frac{\alpha w_O}{\alpha w_O +(1-\alpha)w_I} \right] E[\tilde{Q}(\infty)]$$
- Define $\kappa$: $$\kappa=\frac{(1-\alpha)w_I}{\alpha w_O +(1-\alpha)w_I}$$
- $$E[\tilde{Q}(\infty)]=\frac{\theta}{\kappa}+\frac{\sigma}{\sqrt{2\kappa}}\frac{\phi((-\theta/\sigma)\sqrt{2/\kappa})}{1-\Phi((-\theta/\sigma)\sqrt{2/\kappa})}$$
- Define $\tilde{C}(\alpha)$: $$\tilde{C}(\alpha)=\left[(c\gamma -r)\frac{(1-\alpha)w_I}{\alpha w_O +(1-\alpha)w_I}+h\frac{\alpha w_O}{\alpha w_O +(1-\alpha)w_I} \right]\left(\frac{\theta}{\kappa}+\frac{\sigma}{\sqrt{2\kappa}}\frac{\phi((-\theta/\sigma)\sqrt{2/\kappa})}{1-\Phi((-\theta/\sigma)\sqrt{2/\kappa})}\right)$$
- Optimization problem: $$\min_{\alpha\in[0,1]}\tilde{C}(\alpha)$$

__Comparison with No Abandonment Case__
- Without abandonment, optimal to have only offline queue
	- $\because$ No penalty (even benefits) from offline queue, only penalty with inline queue
- Abandonment creates cost trade-off, making both queues desirable

## 3.2 Solution to Approximating Problem

### 3.2.1 $\theta=0$ $(\lambda=\mu)$

$$\min_{\alpha\in[0,1]}\tilde{C}(\alpha)$$
- Solution: $$\tilde{\alpha}^*=\frac{c\gamma-r-2h}{c\gamma-r-2h+h(w_O/w_I)}$$
	- Valid when $2h<c\gamma -r$
	- If $2h\geq c\gamma -r$ then $\tilde{\alpha}^*=0$,  only offline is optimum
		- $\because$ Inline is way more costly than offline
	- If $h=0$ then only inline is optimum
		- $\because$ No penalty for inline, but offline has positive penalty

### 3.2.2 $\theta\neq0$ $(\lambda\neq\mu)$

__Optimal Queue Configuration__
- For any values of $w_I$ and $w_O$:
	- Exists $\theta_L< \theta_H$ such that:
	    - For $\theta ∈ (\theta_L,\theta_H)$: Optimal to have both inline and offline queues ($α̃^* ∈ (0,1)$)
	    - Otherwise: Optimal to have only one queue ($α̃^* = 0$ or $α̃^* = 1$)

__Behavior in Extreme Cases__
- As $\theta$ becomes small (service capacity >> arrival rate):
	- Optimal to have only inline queue ($α̃^* = 1$)
		- $\because$ Very low holding cost $\&$ No abandonment cost
- As $\theta$ becomes large:
	- Minimized at $α = 0$ (only offline queue)
		- $\because$ Large holding cost
- If abandonment cost ($c$) is low, only offline is optimal
	- $\because$ Offline generates revenue

__Comparison btw Simplified Model__
$$\min_{\alpha\in[0,1]}C(\alpha)\approx \sqrt{\lambda}\min_{\alpha\in[0,1]}\tilde{C}(\alpha)$$
- Tables 2 and 3 confirm that this is the case. 
- Approximation has less than 10% relative error for arrival rates that are as high as 120 per hour when the service rate is 100 per hour
	- This is when approximations are most relevant
	- When the service rate exceeds the arrival rate, the wait times are small, so accurate approximation is not as important

## 4. Waiting Time Quotation

__Recap - Accuracy of Waiting Time Estimates__
- Proposed estimates:
	- Inline: $$W_I(t) = \frac{Q_I(t)}{\mu\alpha}$$
	- Offline: $$W_O(t) = \frac{O(t)}{\mu(1-\alpha)}$$

__Theorem 2__
- Arrival rate: $\lambda$
- Service rate: $\mu(\lambda)=\lambda-\sqrt{\lambda}\theta$
- For $\forall T>0,\lambda \rightarrow \infty$ shows close approximation of actual waiting times $\mathbb{W}$:
	- Inline: $$\sup_{0\leq t\leq T}\sqrt{\lambda}|\mathbb{W}_I^\lambda(t)-W_I^\lambda(t)|\rightarrow0\quad\text{in probability}$$
	- Offline: $$\sup_{0\leq t\leq T}\sqrt{\lambda}|\mathbb{W}_O^\lambda(t)-W_O^\lambda(t)|\rightarrow0\quad\text{in probability}$$
- Analysis:
	- Under parameter condition, offline wait time is accurate
	- Accuracy offline wait time estimation decreases as arrival rate passes service rate
		- $\because$ Percentage of abandoning increases


__Practical Implications__
- For accurate offline wait times:
	- Ask customers to return slightly before estimated service time
	- Example: With arrival/service rates of 100/hour, return 10 minutes early ensures presence

__Ensuring Customer Presence__
- Amount of early return varies with system parameters and average wait time
- Example: For 99% presence in system with rates of 100/hour, return 1.24 minutes early
- Small percentage of errors in estimates has negligible impact on overall system behavior


# 5. Conclusion
- **System Analyzed**: Single-server with inline and offline waiting modes
- **Customer Behavior**: Choose mode with lower delay cost; offline queue may see abandonments
- **Key Findings**:
	- Large demand and fast service allow modeling with one-dimensional reflected diffusion
	- Provides analytic tractability for capacity allocation to minimize average cost
	- Simple waiting time prediction using Little’s Law, despite offline abandonments
- **Validation**: Accuracy confirmed through simulation
- **Applicability**: Results extend to batch service settings, such as amusement park rides